@*@page*@
@using BettingApplication.Models
@*@using Microsoft.AspNetCore.Http*@
@model BettingApplication.ViewModels.MatchesPartialView
@{

    ViewData["Title"] = "Matches";

    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    body {
        background-color: #121212;
        color: white;
    }
    th {
        color: white;
    }
    td {
        color: white;
    }
</style>
    <form asp-action="Index" method="get">
        <div class="form-actions no-color">
            <p>
                Find by sport: <input type="text" name="SearchStringSport" value="@ViewData["currentFilterSport"]" />
                <input type="submit" value="Search" class="btn btn-primary" />
                Legaue: <input type="text" name="SearchStringLeague" value="@ViewData["currentFilterLeague"]" />
                <input type="submit" value="Search" class="btn btn-primary" />
                Team: <input type="text" name="SearchStringTeam" value="@ViewData["currentFilterTeam"]" />
                <input type="submit" value="Search" class="btn btn-primary" />
                <a asp-action="Index">Full List</a>
        </div>
    </form>

<h1>Bet Slip</h1>
<table class="table">
    <thead>
        <tr>
            <th>
                Home Team
            </th>
            <th>
                Away Team
            </th>
            <th>
                Time
            </th>
            <th>
                Type
            </th>
            <th>
                Odd
            </th>
            <th>
                Top Match
            </th>
            <th>
            </th>
        </tr>
    </thead>
    <tbody>
        @using (Html.BeginForm("UserBet", "UserBets", new { CashOut = TempData["CashOut"], TotalOdd = TempData["Odd"] }, FormMethod.Post))
        {
            @foreach (var item in Model.BetSlip)
            {
                {
        <tr>
            <td>
                @Html.DisplayFor(modelItem => item.Match.HomeTeam.Name)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Match.AwayTeam.Name)
            </td>
            <td>
                @{
                    string time = item.Match.Time.ToShortTimeString();
                }
                @Html.DisplayFor(modelItem => time)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Type)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Odd)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.TopMatch)
            </td>
            <td>
                <a asp-controller="BetSlips" asp-action="Delete" asp-route-id="@item.Id" class="btn btn-outline-danger">x</a>
            </td>
        </tr>
                }
            }
            <tr>
                <td>Saldo: @TempData["Saldo"]</td>
                <td>Total Odd: @TempData["Odd"]</td>
                <td>Number of matches: @TempData["NumberOfMatches"]</td>
                <td>Cash Out: <span id="cashOut"></span> @TempData["CashOut"]</td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td><input type="text" name="Stake" id="stake" pattern="^(?!0\.00)\d{1,6}(,\d{3})*(\.\d\d)?$" placeholder="Enter the amount in format 0.00" class="form-control" /></td>
                <td>-5%: <span id="Tax"></span> @TempData["Tax"]</td>
                <td><button type="submit" value="Potvrdi" name="submit" class="btn btn-success">Accept</button></td>
                <td><button type="submit" value="Remove" name="submit" class="btn btn-danger">Remove All</button></td>
            </tr>


        }
    </tbody>
</table>



@if (Model != null)
{
    <table class="table">
        <thead>
            <tr>
                <th><h1>Matches</h1>
                </th>
                <th></th>
               
            </tr>
        </thead>
        <tbody>
            @{
                string temp = null;
            }

            @foreach (var item in Model.Matches)
            {
                @if (item.Time > DateTime.Now)
                {
                    @using (Html.BeginForm("Bet", "BetSlips", new { MatchId = item.Id, top = false }, FormMethod.Post))
                    {
                        <tr>
                            @if (@temp != item.League)
                            {
                                <th>
                                    @Html.DisplayFor(modelItem => item.League)
                                </th>
                                temp = item.League;
                                <th></th>
                                <th>
                                    Time
                                </th>
                                <th>
                                    1
                                </th>
                                <th>
                                    X
                                </th>
                                <th>
                                    2
                                </th>
                                <th>
                                    1X
                                </th>
                                <th>
                                    X2
                                </th>
                                <th>
                                    12
                                </th>
                            }
                        </tr>
                        <tr>

                            <td>
                                @item.HomeTeamName
                            </td>
                            <td>
                                @item.AwayTeamName
                            </td>
                            <td>
                                @item.Time.ToShortTimeString()
                            </td>
                            <td>
                                @if (item._1 > 1)
                                {
                                    <button type="submit" id=@item.Id , name="type" value="1" class="btn btn-primary">@item._1</button>
                                }
                            </td>
                            <td>
                                @if (item._X > 1)
                                {
                                    <button type="submit" id=@item.Id , name="type" value="X" class="btn btn-primary">@item._X</button>
                                }
                            </td>
                            <td>
                                @if (item._2 > 1)
                                {
                                    <button type="submit" id=@item.Id , name="type" value="2" class="btn btn-primary">@item._2</button>
                                }
                            </td>
                            <td>
                                @if (item._1X > 1)
                                {
                                    <button type="submit" id=@item.Id , name="type" value="1X" class="btn btn-primary">@item._1X</button>
                                }
                            </td>
                            <td>
                                @if (item._X2 > 1)
                                {
                                    <button type="submit" id=@item.Id , name="type" value="X2" class="btn btn-primary">@item._X2</button>
                                } 
                            </td>
                            <td>
                                @if (item._12 > 1)
                                {
                                    <button type="submit" id=@item.Id , name="type" value="12" class="btn btn-primary">@item._12</button>
                                }
                            </td>
                            @if (User.IsInRole("Admin"))
                            {
                                <td>
                                    <a class="btn btn-danger" asp-action="Delete" asp-route-id="@item.Id">Delete</a>
                                </td>
                                <td>
                                    <a class="btn btn-primary" asp-action="TopMatch" asp-route-id="@item.Id">TopMatch</a>
                                </td>
                            }

                        </tr>
                    }

                }
            }
        </tbody>
    </table>
}




<script>

    var odd = parseFloat(("@TempData["Odd"]").replace(",","."));

    var stakeDOM =  document.getElementById("stake")
   stakeDOM.addEventListener("click", function (event) {
      event.preventDefault()

      document.getElementById("cashOut").innerHTML = ((parseFloat(stakeDOM.value) / 100 * 95) * odd).toFixed(2)
      document.getElementById("Tax").innerHTML = ((parseFloat(stakeDOM.value) *0.95).toFixed(2));
});
</script>
@if (@TempData["betmsg"] != null)
{
    <script>alert("@TempData["betmsg"]");</script>
}
